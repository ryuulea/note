'=== ⑥ メール本文チェック（E/F列に出力があればエラー）===
Private Function CheckMailBody_Result(ws As Worksheet, headerRow As Long) As String
    Const HEADER As String = "メール本文"
    Const MAX_LEN As Long = 900
    Dim hdrCell As Range, col As Long, startRow As Long, lastRow As Long
    Dim r As Long, txt As String, L As Long
    Dim i As Long, c As String
    Dim outWs As Worksheet
    Dim baseLastE As Long, newLastE As Long
    Dim exportRowNo As Long
    
    ' 出力先シート
    Set outWs = Worksheets("チェック結果")
    
    ' 処理前のE列の最終行を記録
    baseLastE = outWs.Cells(outWs.Rows.Count, "E").End(xlUp).Row
    If baseLastE < 2 Then baseLastE = 1
    exportRowNo = baseLastE + 1
    
    ' ヘッダ列を探す
    Set hdrCell = ws.Rows(headerRow).Find(What:=HEADER, LookAt:=xlWhole)
    If hdrCell Is Nothing Then
        CheckMailBody_Result = "列見出し「" & HEADER & "」が見つかりません。"
        Exit Function
    End If
    col = hdrCell.Column
    
    startRow = headerRow + 2
    lastRow = ws.Cells(ws.Rows.Count, col).End(xlUp).Row
    
    ' === 本文チェック ===
    For r = startRow To lastRow
        txt = CStr(ws.Cells(r, col).Value)
        L = Len(txt)
        
        ' 900文字超過 → E/Fに出力
        If L > MAX_LEN Then
            outWs.Range("E" & exportRowNo).Value = "―"
            outWs.Range("F" & exportRowNo).Value = "表行:" & r & " / 文字数超過 (" & L & "文字)"
            exportRowNo = exportRowNo + 1
        End If
        
        ' ここに「問題文字検出」の処理が既にあるなら、そのままE/Fに出力してOK
        ' E/Fに出力された時点で後で「エラー件数」にカウントされます
    Next r
    
    ' === 処理後のE列の最終行を記録
    newLastE = outWs.Cells(outWs.Rows.Count, "E").End(xlUp).Row
    If newLastE < 2 Then newLastE = 1
    
    ' 差分行数 = 今回のエラー件数
    Dim efAdded As Long
    efAdded = newLastE - baseLastE
    
    If efAdded = 0 Then
        CheckMailBody_Result = "OK（全て " & MAX_LEN & "文字以内）"
    Else
        CheckMailBody_Result = "エラー " & efAdded & " 件 : ご確認ください"
    End If
End Function
