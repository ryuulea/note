Public Sub ExportDeleteSQL()

    Dim wsMail As Worksheet, wsShop As Worksheet
    Dim lastMail As Long, i As Long, j As Long
    Dim fnum As Integer, filePath As String
    Dim val As String, keyCd As String
    Dim outIdx As Long, sql As String
    
    Set wsMail = ThisWorkbook.Sheets("メール本文テンプレート情報")
    Set wsShop = ThisWorkbook.Sheets("対象店舗")
    
    lastMail = wsMail.Cells(wsMail.Rows.Count, "A").End(xlUp).Row
    
    filePath = ThisWorkbook.Path & "\delete_output.sql"
    fnum = FreeFile
    Open filePath For Output As #fnum
    
    outIdx = 0
    For i = 11 To lastMail
        val = Trim(CStr(wsMail.Cells(i, 4).Value2))   ' D列=扱い
        
        If val = "削除" Then
            outIdx = outIdx + 1
            keyCd = Format(outIdx, "0000")
            
            ' 直接给了取次店コード
            If wsMail.Cells(i, 6).Value <> "" Then
                sql = "DELETE FROM WPWP01.TB_ENT_MAIL_TEMPLATE_WORK" & vbCrLf & _
                      "(CTGRY_CD, KEY_CD, COLUMN_NAME, VAL, LAST_UPD_DATE, LAST_UPD_USER, INS_DATE, INS_USER)" & vbCrLf & _
                      "VALUES('001','" & keyCd & "','SB代理店コード','" & wsMail.Cells(i, 6).Value & "',SYSDATE,'scsk_uchin',SYSDATE,'scsk_uchin');"
                Print #fnum, sql
            End If
            
            ' 如果写了「対象店舗」→ 去展开
            If wsMail.Cells(i, 5).Value = "対象店舗" Then
                For j = 2 To wsShop.Cells(wsShop.Rows.Count, "A").End(xlUp).Row
                    If wsShop.Cells(j, 1).Value <> "" Then
                        outIdx = outIdx + 1
                        keyCd = Format(outIdx, "0000")
                        sql = "DELETE FROM WPWP01.TB_ENT_MAIL_TEMPLATE_WORK" & vbCrLf & _
                              "(CTGRY_CD, KEY_CD, COLUMN_NAME, VAL, LAST_UPD_DATE, LAST_UPD_USER, INS_DATE, INS_USER)" & vbCrLf & _
                              "VALUES('001','" & keyCd & "','SB代理店コード','" & wsShop.Cells(j, 1).Value & "',SYSDATE,'scsk_uchin',SYSDATE,'scsk_uchin');"
                        Print #fnum, sql
                    End If
                Next j
            End If
        End If
    Next i
    
    Close #fnum
    MsgBox "削除SQL出力完成: " & filePath, vbInformation

End Sub
