Public Sub CheckAll()
    Dim ws As Worksheet: Set ws = ActiveSheet
    Dim headerRow As Long
    Dim genreResult As String, subjectResult As String, bodyResult As String
    Dim wsOut As Worksheet
    Dim lines() As String, i As Long
    Dim msg As String
    Dim errCountGenre As Long, errCountSubject As Long, errCountBody As Long
    
    headerRow = GetHeaderRow(ws)
    If headerRow = -1 Then
        MsgBox "表頭に「メール本文」が見つかりません。", vbExclamation
        Exit Sub
    End If
    
    ' === 各チェック結果 ===
    genreResult = CheckTemplateGenre_Result(ws, headerRow)
    subjectResult = CheckMailSubject_Result(ws, headerRow)
    bodyResult = CheckMailBody_Result(ws, headerRow)
    
    ' === エラー件数を数える ===
    errCountGenre = CountErrors(genreResult)
    errCountSubject = CountErrors(subjectResult)
    errCountBody = CountErrors(bodyResult)
    
    ' === 出力先シート ===
    Set wsOut = Worksheets("チェック結果")
    wsOut.Range("A:C").ClearContents
    
    ' ヘッダー
    wsOut.Range("A1").Value = "ジャンル名チェック"
    wsOut.Range("B1").Value = "件名チェック"
    wsOut.Range("C1").Value = "本文チェック"
    
    ' ジャンル名 → A列
    lines = Split(genreResult, vbCrLf)
    For i = 0 To UBound(lines)
        wsOut.Cells(i + 2, 1).Value = lines(i)
    Next i
    
    ' 件名 → B列
    lines = Split(subjectResult, vbCrLf)
    For i = 0 To UBound(lines)
        wsOut.Cells(i + 2, 2).Value = lines(i)
    Next i
    
    ' 本文 → C列
    lines = Split(bodyResult, vbCrLf)
    For i = 0 To UBound(lines)
        wsOut.Cells(i + 2, 3).Value = lines(i)
    Next i
    
    ' === MsgBox 簡潔表示 ===
    msg = "テンプレートジャンル名：" & IIf(errCountGenre > 0, "エラーあり (" & errCountGenre & "件)", "OK") & vbCrLf & _
          "メール件名：" & IIf(errCountSubject > 0, "エラーあり (" & errCountSubject & "件)", "OK") & vbCrLf & _
          "メール本文：" & IIf(errCountBody > 0, "エラーあり (" & errCountBody & "件)", "OK") & vbCrLf & vbCrLf & _
          "詳細はチェック結果シートをご確認ください。"
    
    MsgBox msg, vbInformation
End Sub

' === エラー件数カウント用 ===
Private Function CountErrors(resultText As String) As Long
    If InStr(resultText, "エラー") > 0 Then
        CountErrors = UBound(Split(resultText, vbCrLf)) + 1
    Else
        CountErrors = 0
    End If
End Function
