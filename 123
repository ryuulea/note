Public Sub SqlDeleteExport()

    Dim wsMail As Worksheet, wsShop As Worksheet
    Dim lastMail As Long, lastShop As Long
    Dim i As Long, j As Long
    Dim sql As String, keyCd As String
    Dim fnum As Integer, filePath As String
    
    Set wsMail = Worksheets("メール本文テンプレート情報")
    Set wsShop = Worksheets("対象店舗")
    
    lastMail = wsMail.Cells(wsMail.Rows.Count, 1).End(xlUp).Row
    lastShop = wsShop.Cells(wsShop.Rows.Count, 1).End(xlUp).Row
    
    filePath = ThisWorkbook.Path & "\" & Left(ThisWorkbook.Name, InStrRev(ThisWorkbook.Name, ".") - 1) & "_delete.sql"
    fnum = FreeFile
    Open filePath For Output As #fnum
    
    For i = 2 To lastMail
        If wsMail.Cells(i, 2).Value <> "" Then
            
            ' KEY_CD 自动流水号
            keyCd = Format(i - 1, "0000")
            
            If wsMail.Cells(i, 2).Value = "対象店舗" Then
                ' 去对象店舗sheet里展开
                For j = 2 To lastShop
                    sql = "DELETE FROM WPWP01.TB_ENT_MAIL_TEMPLATE_WORK " & vbCrLf & _
                          "(CTGRY_CD, KEY_CD, COLUMN_NAME, VAL, LAST_UPD_DATE, LAST_UPD_USER, INS_DATE, INS_USER)" & vbCrLf & _
                          "VALUES('001','" & keyCd & "','SB代理店コード','" & wsShop.Cells(j, 1).Value & "'," & _
                          "SYSDATE,'scsk_uchin',SYSDATE,'scsk_uchin');"
                    Print #fnum, sql
                Next j
            Else
                ' 直接用给定的店舗コード
                sql = "DELETE FROM WPWP01.TB_ENT_MAIL_TEMPLATE_WORK " & vbCrLf & _
                      "(CTGRY_CD, KEY_CD, COLUMN_NAME, VAL, LAST_UPD_DATE, LAST_UPD_USER, INS_DATE, INS_USER)" & vbCrLf & _
                      "VALUES('001','" & keyCd & "','SB代理店コード','" & wsMail.Cells(i, 2).Value & "'," & _
                      "SYSDATE,'scsk_uchin',SYSDATE,'scsk_uchin');"
                Print #fnum, sql
            End If
            
        End If
    Next i
    
    Close #fnum
    MsgBox "削除SQL出力完了: " & vbCrLf & filePath, vbInformation

End Sub
