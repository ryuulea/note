For r = startRow To lastRow
    txt = CStr(ws.Cells(r, col).Value)
    L = Len(txt)
    
    ' --- 900文字超過チェック ---
    If L > MAX_LEN Then
        errCount = errCount + 1
        Worksheets("チェック結果").Range("E" & exportRowNo).Value = "―"
        Worksheets("チェック結果").Range("F" & exportRowNo).Value = _
            "表行:" & r & " / 文字数超過 (" & L & "文字)"
        exportRowNo = exportRowNo + 1
    End If
    
    ' --- Shift-JIS非対応文字チェック ---
    For i = 1 To L
        c = Mid(txt, i, 1)
        If c <> sQuestion And Asc(c) <> Asc(sQuestion) Then
            cp = AscW(c)
            ' SJISで保存できない文字をチェックするならここに判定を追加する
            If Not IsSjisSafe(cp) Then
                Worksheets("チェック結果").Range("E" & exportRowNo).Value = c
                Worksheets("チェック結果").Range("F" & exportRowNo).Value = _
                    "表行:" & r & " / 正文行:" & i & " / 文字コード:" & Hex(cp)
                exportRowNo = exportRowNo + 1
                errCount = errCount + 1
            End If
        End If
    Next i
Next r


Private Function IsSjisSafe(cp As Long) As Boolean
    On Error Resume Next
    Dim s As String
    s = ChrW(cp)
    Dim b() As Byte
    b = StrConv(s, vbFromUnicode, 932) ' 932 = Shift-JIS
    If StrConv(b, vbUnicode, 932) = s Then
        IsSjisSafe = True
    Else
        IsSjisSafe = False
    End If
End Function
